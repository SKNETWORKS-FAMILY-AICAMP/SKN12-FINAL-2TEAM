version: '3.8'

services:
  # Backend API Server (Docker HubÏóêÏÑú Îã§Ïö¥Î°úÎìú)
  backend:
    image: ${DOCKERHUB_USERNAME}/ai-trading-backend:local
    container_name: trading-backend-hub
    ports:
      - "8000:8000"
    environment:
      - APP_ENV=LOCAL
      - PYTHONUNBUFFERED=1
    volumes:
      # Backend ÏÑ§Ï†ï ÌååÏùº ÎßàÏö¥ÌåÖ (01 Î¨∏ÏÑú Î∞©Ïãù)
      - "C:/SKN12-FINAL-2TEAM/base_server/application/base_web_server/base_web_server-config_local.json:/app/application/base_web_server/base_web_server-config_local.json:ro"
      # Î°úÍ∑∏ ÎîîÎ†âÌÜ†Î¶¨ ÎßàÏö¥ÌåÖ
      - "C:/docker-logs:/app/logs"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - trading-network

  # Frontend Next.js Server (Docker HubÏóêÏÑú Îã§Ïö¥Î°úÎìú)
  frontend:
    image: ${DOCKERHUB_USERNAME}/ai-trading-frontend:local
    container_name: trading-frontend-hub
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    volumes:
      # Frontend ÏÑ§Ï†ï ÌååÏùº ÎßàÏö¥ÌåÖ (Backend Î∞©Ïãù Îî∞ÎùºÌï®)
      - "C:/docker-frontend-configs/.env:/app/.env:ro"
    depends_on:
      backend:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - trading-network

networks:
  trading-network:
    driver: bridge

# =============================================================================
# üöÄ ÏÇ¨Ïö©Î≤ï (Docker Hub Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïö©)
# =============================================================================
#
# 1Ô∏è‚É£ ÌôòÍ≤ΩÎ≥ÄÏàò ÏÑ§Ï†ï:
#    set DOCKERHUB_USERNAME=your-username
#    
# 2Ô∏è‚É£ ÎòêÎäî .env ÌååÏùº ÏÉùÏÑ±:
#    echo "DOCKERHUB_USERNAME=your-username" > .env
#
# 3Ô∏è‚É£ Ïã§Ìñâ:
#    docker-compose -f docker-compose.hub.yml up -d
#
# 4Ô∏è‚É£ ÌôïÏù∏:
#    http://localhost:8000  # Backend API
#    http://localhost:3000  # Frontend UI
#
# 5Ô∏è‚É£ Ï†ïÎ¶¨:
#    docker-compose -f docker-compose.hub.yml down
#
# =============================================================================