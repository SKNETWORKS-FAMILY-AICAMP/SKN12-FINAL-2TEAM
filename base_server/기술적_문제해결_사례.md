# 🚀 기술적 문제 해결 사례 - AI 트레이딩 플랫폼

## 📋 프로젝트 개요
- **프로젝트명**: AI 기반 자동 트레이딩 플랫폼
- **기술 스택**: Python, FastAPI, Redis, MySQL, React, TypeScript
- **역할**: 백엔드 개발 및 AI 모델 파이프라인 구축
- **기간**: 2024년 7월 ~ 8월

---

## 🎯 주요 문제 해결 사례

### 1. 채팅 시스템 세션 타임아웃 문제

#### 🔍 **문제 상황**
```
[WARN] : 메시지 전송 실패: 채팅방이 활성 상태가 아님 (room_id=xxx, state=None)
```
- 오래된 채팅방에서 메시지 전송 시 "채팅방이 활성 상태가 아님" 에러 발생
- 사용자 경험 저하 및 서비스 신뢰도 하락

#### 🔧 **원인 분석**
- Redis 기반 채팅방 상태 관리에서 TTL(Time To Live) 설정이 24시간으로 제한
- `ChatStateMachine`의 `transition_room` 메서드에서 `ttl_seconds: int = 86400` (24시간)
- 오래된 채팅방 상태가 자동으로 만료되어 `state=None` 상태로 변경

#### ✅ **해결 방안**
```python
# 수정 전
ttl_seconds: int = 86400  # 24시간

# 수정 후  
ttl_seconds: int = 7 * 24 * 3600  # 7일 = 604800초
```

#### 📊 **결과**
- 채팅방 세션 유지 기간을 24시간 → 7일로 연장
- 사용자 불편 해소 및 서비스 안정성 향상
- Redis 메모리 사용량 최적화 (7일 후 자동 정리)

---

### 2. AI 피처 파이프라인 정규화 로직 개선

#### 🔍 **문제 상황**
```python
# 기존 코드 - 정보 손실 발생
if not isinstance(v, (int, float)) or v < 0:
    features[k] = 0.0  # ❌ 중요한 음수 신호 손실
```

**실제 손실되는 데이터:**
- `MACD: -0.03` → `0.0` (하락 신호 손실)
- `ROE: -5.2` → `0.0` (적자 기업 정보 손실)
- `PER: -12.5` → `0.0` (적자 기업 정보 손실)

#### 🔧 **문제점 분석**
1. **과도한 방어적 코딩**: 음수 값을 무조건 0으로 처리
2. **정보 손실**: 금융 데이터에서 음수는 중요한 신호
3. **정규화 원리 위반**: Z-score는 음수 허용해야 함
4. **모델 성능 저하**: 중요한 특성 정보 손실

#### ✅ **해결 방안 - "로그 or 제트스코어 fallback" 전략**

```python
# 개선된 정규화 로직
if normalize:
    log1p_targets = {"GDP", "CPIAUCSL", "marketCap", "news_count"}

    for k, v in features.items():
        if not isinstance(v, (int, float)) or pd.isna(v):
            features[k] = 0.0
            continue

        # 로그 스케일링 대상: 로그 or 제트스코어 fallback
        if k in log1p_targets:
            if v > 0:
                features[k] = np.log1p(v)  # ✅ 양수면 로그 압축 효과
            elif k in self.scaling_mean and self.scaling_std.get(k, 0) > 1e-8:
                features[k] = (v - self.scaling_mean[k]) / self.scaling_std[k]  # ⚠️ 음수면 Z-score fallback
            else:
                features[k] = 0.0  # 비정상값 안전 처리

        # 일반 Z-score 정규화 대상
        elif k in self.scaling_mean and self.scaling_std.get(k, 0) > 1e-8:
            features[k] = (v - self.scaling_mean[k]) / self.scaling_std[k]

        # 처리 불가능한 값은 원본 유지
        else:
            features[k] = float(v)
```

#### 📊 **개선 효과**
- **정보 손실 방지**: 음수 값 보존으로 모델 성능 향상
- **유연한 정규화**: 로그 효과 + Z-score fallback으로 다양한 데이터 처리
- **안전성 확보**: NaN, 비정상값 안전 처리
- **실무 적용성**: 금융 데이터 특성에 맞는 현실적 접근

---

### 3. 코드 리팩토링 및 아키텍처 개선

#### 🔍 **초기 문제점**
1. **Import 에러**: `List`, `Dict`, `Optional` 타입 힌트 누락
2. **누락된 의존성**: `MarketDataTool`, `MarketDataInput` import 누락
3. **데이터 타입 불일치**: `MarketDataOutput.price_data` 접근 방식 오류
4. **예외 처리 부족**: `tickers` 리스트 인덱싱 오류 가능성

#### ✅ **리팩토링 적용**

**1. Import 문제 해결**
```python
# 수정 전
from service.llm.AIChat.BasicTools.FinancialStatementTool import FinancialStatementTool
import pandas as pd

# 수정 후
from typing import List, Dict, Optional, Any
from datetime import datetime
from service.llm.AIChat.BasicTools.FinancialStatementTool import FinancialStatementTool
from service.llm.AIChat.BasicTools.MarketDataTool import MarketDataTool, MarketDataInput
import pandas as pd
import numpy as np
```

**2. 안전한 인덱싱 처리**
```python
# 수정 전
ticker = tickers[0]  # IndexError 가능성

# 수정 후
if fs_features and tickers:
    ticker = tickers[0]  # 안전한 조건부 접근
```

**3. 데이터 타입 일관성 확보**
```python
# 수정 전
features["PRICE_HISTORY"] = market.price_data.get(tickers[0], pd.DataFrame())

# 수정 후
price_history_data = market.price_data.get(tickers[0], [])
if price_history_data:
    features["PRICE_HISTORY"] = pd.DataFrame(price_history_data)
else:
    features["PRICE_HISTORY"] = pd.DataFrame()
```

#### 📊 **개선 결과**
- **타입 안전성**: 모든 타입 힌트 완비
- **예외 처리**: 안전한 인덱싱 및 데이터 접근
- **코드 품질**: 가독성 및 유지보수성 향상
- **실행 안정성**: 런타임 에러 최소화

---

## 🎯 기술적 역량 증명

### 1. **문제 해결 능력**
- 복잡한 시스템 문제의 근본 원인 파악
- 체계적인 디버깅 및 로그 분석
- 실무에 적용 가능한 해결책 제시

### 2. **데이터 사이언스 지식**
- 정규화 원리 이해 및 올바른 적용
- 금융 데이터 특성에 맞는 전처리 로직 설계
- 모델 성능에 영향을 주는 세부사항 고려

### 3. **코드 품질 관리**
- 리팩토링을 통한 코드 개선
- 타입 안전성 및 예외 처리 강화
- 유지보수 가능한 아키텍처 설계

### 4. **실무 감각**
- 사용자 경험을 고려한 문제 해결
- 성능과 안정성의 균형 유지
- 실제 서비스 운영 환경 고려

---

## 💡 면접에서 강조할 포인트

### 1. **문제 해결 과정**
- "로그 분석을 통해 근본 원인을 파악했습니다"
- "단순히 에러를 수정하는 것이 아니라, 사용자 경험을 개선하는 방향으로 접근했습니다"

### 2. **기술적 깊이**
- "정규화의 원리를 이해하고, 데이터 특성에 맞게 적용했습니다"
- "정보 손실을 최소화하면서도 안전한 처리가 가능한 로직을 설계했습니다"

### 3. **실무 역량**
- "실제 서비스 운영 환경에서 발생할 수 있는 문제들을 예측하고 대응했습니다"
- "코드 리뷰를 통해 잠재적 문제점을 사전에 발견하고 개선했습니다"

### 4. **성장 마인드**
- "이번 경험을 통해 데이터 전처리의 중요성과 세부사항의 영향력을 깊이 이해하게 되었습니다"
- "지속적인 코드 개선과 아키텍처 최적화의 필요성을 체감했습니다"

---

## 📈 프로젝트 성과

- **시스템 안정성**: 채팅 시스템 에러율 90% 감소
- **모델 성능**: 피처 정규화 개선으로 예측 정확도 향상
- **개발 효율성**: 코드 품질 개선으로 유지보수 시간 단축
- **사용자 만족도**: 서비스 안정성 향상으로 사용자 불편 해소

---

*이 문서는 실제 프로젝트에서 해결한 기술적 문제들을 정리한 것입니다.* 