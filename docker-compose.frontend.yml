version: '3.8'

services:
  frontend:
    image: ashone91/trading-frontend:latest
    container_name: trading-frontend-prod
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    volumes:
      # ë¡œê·¸ ë””ë ‰í† ë¦¬ ë§ˆìš´íŒ…
      - "/opt/trading/logs:/app/logs"
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - trading-frontend-network

networks:
  trading-frontend-network:
    driver: bridge

# =============================================================================
# ðŸš€ Frontend ì„œë¹„ìŠ¤ ì‚¬ìš©ë²• (AWS EC2)
# =============================================================================
#
# 1ï¸âƒ£ ì„¤ì • íŒŒì¼ ì¤€ë¹„:
#    sudo mkdir -p /opt/trading/frontend-config
#    sudo mkdir -p /opt/trading/logs
#    sudo chown -R ubuntu:ubuntu /opt/trading
#    
#    # Frontend í™˜ê²½ ì„¤ì • íŒŒì¼ ìƒì„± (.env)
#    sudo tee /opt/trading/frontend-config/.env > /dev/null << 'EOF'
#    NEXT_PUBLIC_API_URL=http://YOUR_BACKEND_EC2_PUBLIC_IP:8000
#    NEXT_PUBLIC_WS_URL=ws://YOUR_BACKEND_EC2_PUBLIC_IP:8000
#    NEXT_PUBLIC_API_TIMEOUT=10000
#    NODE_ENV=production
#    EOF
#    
#    # Backend EC2 Public IPë¡œ ë³€ê²½ (ì‹¤ì œ IP ìž…ë ¥)
#    sudo sed -i 's/YOUR_BACKEND_EC2_PUBLIC_IP/52.78.123.45/g' /opt/trading/frontend-config/.env
#
# 2ï¸âƒ£ Frontend ì„œë¹„ìŠ¤ ì‹¤í–‰:
#    docker-compose -f docker-compose.frontend.yml pull
#    docker-compose -f docker-compose.frontend.yml up -d
#
# 3ï¸âƒ£ ìƒíƒœ í™•ì¸:
#    docker-compose -f docker-compose.frontend.yml ps
#    docker-compose -f docker-compose.frontend.yml logs -f frontend
#
# 4ï¸âƒ£ í—¬ìŠ¤ì²´í¬:
#    curl http://localhost:3000
#
# 5ï¸âƒ£ ì„œë¹„ìŠ¤ ì¤‘ì§€:
#    docker-compose -f docker-compose.frontend.yml down
#
# =============================================================================