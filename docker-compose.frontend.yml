version: '3.8'

services:
  frontend:
    image: ashone91/trading-frontend:latest
    container_name: trading-frontend-prod
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    volumes:
      # Frontend ì„¤ì • íŒŒì¼ ë§ˆìš´íŒ… (ë¡œì»¬ í…ŒìŠ¤íŠ¸ ë°©ì‹ê³¼ ë™ì¼)
      - "/opt/trading/frontend-config/.env:/app/.env:ro"
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - trading-frontend-network

networks:
  trading-frontend-network:
    driver: bridge

# =============================================================================
# ðŸš€ Frontend ì„œë¹„ìŠ¤ ì‚¬ìš©ë²• (AWS EC2)
# =============================================================================
#
# 1ï¸âƒ£ ì„¤ì • íŒŒì¼ ì¤€ë¹„:
#    sudo mkdir -p /opt/trading/frontend-config
#    sudo chown -R ubuntu:ubuntu /opt/trading
#    
#    # Frontend í™˜ê²½ ì„¤ì • íŒŒì¼ ìƒì„±
#    sudo tee /opt/trading/frontend-config/.env > /dev/null << 'EOF'
#    NEXT_PUBLIC_API_URL=https://bullant-kr.com
#    NEXT_PUBLIC_WS_URL=wss://bullant-kr.com
#    BACKEND_URL=https://bullant-kr.com
#    NODE_ENV=production
#    EOF
#
# 2ï¸âƒ£ Frontend ì„œë¹„ìŠ¤ ì‹¤í–‰:
#    docker-compose -f docker-compose.frontend.yml pull
#    docker-compose -f docker-compose.frontend.yml up -d
#
# 3ï¸âƒ£ ìƒíƒœ í™•ì¸:
#    docker-compose -f docker-compose.frontend.yml ps
#    docker-compose -f docker-compose.frontend.yml logs -f frontend
#
# 4ï¸âƒ£ í—¬ìŠ¤ì²´í¬:
#    curl http://localhost:3000
#
# 5ï¸âƒ£ ì„œë¹„ìŠ¤ ì¤‘ì§€:
#    docker-compose -f docker-compose.frontend.yml down
#
# =============================================================================